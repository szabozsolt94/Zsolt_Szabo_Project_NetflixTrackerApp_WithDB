@model List<int>

@{
    ViewData["Title"] = "Watched Movies";
}

<h1>My Watched Movies</h1>

<div id="watchedContainer" class="container">
    <!-- Movie cards will be injected here -->
</div>

<script>
    const watchedMovieIDs = @Html.Raw(Json.Serialize(Model)); // Pass C# list to JS
    const apiBaseUrl = 'http://localhost:62481'; // WebAPI port

    watchedMovieIDs.forEach(movieId => {
        fetch(`${apiBaseUrl}/api/NetflixMovies/${movieId}`)
            .then(response => {
                if (!response.ok) throw new Error("Movie not found");
                return response.json();
            })
            .then(movie => {
                const $card = $('<div>', {
                    class: 'card',
                    'data-type': movie.Type.toLowerCase(),
                    'data-movie-id': movie.MovieID
                });

                // Create the title element first
                const $title = $('<h3>').text(`${movie.Title} (${movie.Year})`);

                // Create the image element
                const $img = $('<img>', {
                    src: movie.Image
                        ? `data:image/jpeg;base64,${movie.Image}`
                        : '/img/moviecardplaceholder.jpg',
                    alt: movie.Title
                });

                // Append the title first, then the image to the card
                $card.append($title, $img);

                $('#watchedContainer').append($card);
            })
            .catch(err => console.error("Error:", err.message));
    });
</script>

